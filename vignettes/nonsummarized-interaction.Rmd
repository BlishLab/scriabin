---
title: "R Notebook"
output: html_notebook
---

Here we will illustrate the first Scriabin workflow: generating and analyzing a full dataset cell-cell interaction matrix. We choose the panc8 dataset of pancreas islets that can be easily installed via SeuratData. 

Because one dimension of the cell-cell interaction matrix is the (number of cells in the dataset)^2, it is impractical to generate and analyze this matrix for medium-to-large datasets. In these situations, we recommend trying the other two workflows of Scriabin. Namely, identification of cells whose magnitude of communication 

Load libraries

```{r}
library(Seurat)
library(SeuratData)
library(scriabin)
library(tidyverse)
```

To install the panc8 dataset:
```{r}
install.packages("https://seurat.nygenome.org/src/contrib/panc8.SeuratData_3.0.2.tar.gz", repos = NULL, type = "source") 
library(panc8.SeuratData)
panc8 <- LoadData("panc8")
```

Analyze the fluidigmc1 dataset for the single dataset tutorial

Analyze the indrop dataset for the interaction programs tutorial
```{r}
panc_fl <- subset(panc8, cells = colnames(panc8)[panc8$tech=="fluidigmc1"])
panc_fl <- SCTransform(panc_fl, verbose = F) %>%
  RunPCA(verbose = F) %>%
  RunUMAP(dims = 1:30, verbose = F)
DimPlot(panc_fl, group.by = "celltype", label = T, repel = T) + NoLegend()
```


```{r}

### NEED TO TRANSLATE METADATA INTO THIS NEW SEURAT OBJECT ###
panc_fl_ccim <- GenerateCCIM(panc_fl) %>%
  ScaleData() %>%
  FindVariableFeatures() %>%
  RunPCA() %>% 
  RunUMAP(dims = 1:10)

DimPlot(panc_fl_ccim)
```

